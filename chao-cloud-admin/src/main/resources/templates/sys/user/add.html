<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head th:include="include :: header"></head>
<link rel="stylesheet" href="/sys/css/formSelects-v4.css" />
<body>
	<form class="layui-form" action="" lay-filter="user-add-form" style="margin-top: 20px;">
		<div class="layui-form-item">
			<label class="layui-form-label">用户名：</label>
			<div class="layui-input-block">
				<input name="username" autocomplete="off" class="layui-input" placeholder="请输入用户名"
					lay-verify="required">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">密码：</label>
			<div class="layui-input-block">
				<input name="password" type="password" placeholder="请输入密码" autocomplete="off"
					class="layui-input" lay-verify="required">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">真实名称：</label>
			<div class="layui-input-block">
				<input name="name" placeholder="请输入真实名称" autocomplete="off" class="layui-input"
					lay-verify="required">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">手机号：</label>
			<div class="layui-input-block">
				<input name="mobile" placeholder="请输入手机号" autocomplete="off" class="layui-input"
					lay-verify="required|phone">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">E-mail：</label>
			<div class="layui-input-block">
				<input name="email" placeholder="请输入邮箱地址" autocomplete="off" class="layui-input"
					lay-verify="required|email">
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">选择角色：</label>
			<div class="layui-input-block">
				<select name="roleIds" xm-select="roleIds">
					<option value="">请选择角色</option>
					<option th:each="role:${roles}" th:value="${role.roleId}" th:text="${role.roleName}"></option>
				</select>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">选择部门：</label>
			<div class="layui-inline">
				<div class="layui-input-inline">
					<input name="deptId" type="hidden">
					<input name="deptName" lay-verify="required" readonly="readonly" class="layui-input layui-elip"
						placeholder="请选择部门">
				</div>
			</div>
			<div class="layui-inline">
				<div class="layui-input-inline">
					<a id="userGroup" href="javascript:;" class="layui-btn layui-btn-sm" lay-event="edit">
						<i class="layui-icon  layui-icon-group"></i>
					</a>
				</div>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">状态：</label>
			<div class="layui-input-block">
				<input type="radio" name="status" value="1" title="正常" checked>
				<input type="radio" name="status" value="0" title="禁用">
			</div>
		</div>
		<div class="layui-form-item">
			<div class="layui-input-block">
				<button class="layui-btn" lay-submit="" lay-filter="user-add">立即提交</button>
			</div>
		</div>
	</form>
	<div th:include="include::footer"></div>
	<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
	<script>
		//全局定义一次, 加载formSelects
		layui.config({
			base : '/sys/js/' //此处路径请自行处理, 可以使用绝对路径
		}).extend({
			formSelects : 'formSelects-v4'
		});
		layui.use([ 'layer', 'jquery', 'form', 'formSelects' ], function() {
			var $ = layui.jquery;
			var layer = layui.layer;
			var form = layui.form;
			var formSelects = layui.formSelects;
			//角色下拉框
			formSelects.render('roleIds');
			//选择 部门
			$("#userGroup").click(function() {
				layer.open({
					type : 2,
					title : '选择部门',
					maxmin : false,
					shadeClose : false, // 点击遮罩关闭层
					area : [ '40%', '50%' ],
					content : '/sys/dept/choose' // iframe的url
				});
			})

			//监听提交
			form.on('submit(user-add)', function(data) {
				//提交数据data.field
				$.ajax({
					cache : true,
					type : "POST",
					url : "/sys/user/save",
					data : data.field,
					async : false,
					error : function(request) {
						laryer.alert("Connection error");
					},
					success : function(r) {
						if (r.retCode == '0000') {
							parent.layer.msg("保存成功");
							parent.location.reload(); // 父页面刷新
							var index = parent.layer.getFrameIndex(window.name); // 获取窗口索引
							parent.layer.close(index);
						} else {
							layer.alert(r.retMsg)
						}
					}
				});
				return false;
			});
		});
	</script>
</body>
</html>